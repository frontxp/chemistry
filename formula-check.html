<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂåñÂ≠¶ÂºèÊ£ÄÈ™å - ÂåñÂ≠¶Â≠¶‰π†Âä©Êâã</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s ease;
        }
        
        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2a 0%, #2d2d3a 100%);
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }
        
        body.dark-mode .container {
            background: #2d2d3a;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        .page-header {
            display: flex;
            align-items: center;
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            transition: background 0.3s ease;
        }
        
        body.dark-mode .page-header {
            background: #3d3d4a;
            border-bottom-color: #4d4d5a;
        }
        
        .back-btn {
            background: white;
            border: 1px solid #dee2e6;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            margin-right: 20px;
            text-decoration: none;
            color: #2c3e50;
        }
        
        body.dark-mode .back-btn {
            background: #4d4d5a;
            border-color: #5d5d6a;
            color: #e0e0e0;
        }
        
        .back-btn:hover {
            background: #e9ecef;
        }
        
        body.dark-mode .back-btn:hover {
            background: #5d5d6a;
        }
        
        .page-title {
            font-size: 20px;
            color: #2c3e50;
            font-weight: 600;
            transition: color 0.3s ease;
        }
        
        body.dark-mode .page-title {
            color: #e0e0e0;
        }
        
        .mode-switch-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-left: auto;
        }
        
        .mode-switch-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }
        
        body.dark-mode .mode-switch-btn {
            background: #4a90e2;
        }
        
        body.dark-mode .mode-switch-btn:hover {
            background: #3b7bc4;
        }
        
        .content {
            padding: 20px 30px;
        }
        
        /* Âø´ÈÄüËæìÂÖ•Ê®°ÂºèÊ†∑Âºè */
        .quick-input-section {
            display: none;
        }
        
        .quick-input-section.active {
            display: block;
        }
        
        .card-mode-section {
            display: block;
        }
        
        .card-mode-section.hidden {
            display: none;
        }
        
        .formula-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            font-family: 'Courier New', monospace;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .formula-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        body.dark-mode .formula-input {
            background: #3d3d4a;
            border-color: #4d4d5a;
            color: #e0e0e0;
        }
        
        body.dark-mode .formula-input:focus {
            border-color: #4a90e2;
        }
        
        .input-hint {
            margin-top: 10px;
            font-size: 12px;
            color: #7f8c8d;
            transition: color 0.3s ease;
        }
        
        body.dark-mode .input-hint {
            color: #a0a0a0;
        }
        
        /* ÂÖÉÁ¥†ÂàÜÁ±ªÊ†∑Âºè */
        .category-section {
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            transition: border-color 0.3s ease;
        }
        
        body.dark-mode .category-section {
            border-color: #4d4d5a;
        }
        
        .category-header {
            background: #f8f9fa;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        body.dark-mode .category-header {
            background: #3d3d4a;
        }
        
        .category-header:hover {
            background: #e9ecef;
        }
        
        body.dark-mode .category-header:hover {
            background: #4d4d5a;
        }
        
        .category-title {
            font-weight: 600;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: color 0.3s ease;
        }
        
        body.dark-mode .category-title {
            color: #e0e0e0;
        }
        
        .category-icon {
            font-size: 20px;
        }
        
        .toggle-icon {
            font-size: 20px;
            transition: transform 0.3s ease;
        }
        
        .category-section.collapsed .toggle-icon {
            transform: rotate(-90deg);
        }
        
        .category-content {
            padding: 15px;
            display: block;
        }
        
        .category-section.collapsed .category-content {
            display: none;
        }
        
        .element-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 12px;
        }
        
        .element-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 12px;
            transition: all 0.3s ease;
        }
        
        body.dark-mode .element-card {
            background: #3d3d4a;
            border-color: #4d4d5a;
        }
        
        .element-card:hover {
            border-color: #667eea;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.2);
        }
        
        .element-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .element-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
            transition: color 0.3s ease;
        }
        
        body.dark-mode .element-name {
            color: #e0e0e0;
        }
        
        .element-symbol {
            color: #667eea;
            font-weight: bold;
            font-size: 16px;
        }
        
        .element-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .quantity-display {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
            min-width: 25px;
            text-align: center;
            transition: color 0.3s ease;
        }
        
        body.dark-mode .quantity-display {
            color: #e0e0e0;
        }
        
        .control-buttons {
            display: flex;
            gap: 4px;
        }
        
        .control-btn {
            width: 28px;
            height: 28px;
            border:1px solid #dee2e6;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.2s ease;
        }
        
        body.dark-mode .control-btn {
            background: #4d4d5a;
            border-color: #5d5d6a;
            color: #e0e0e0;
        }
        
        .control-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        /* È¢ÑËßàÂå∫Âüü */
        .preview-section {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid #2196f3;
            transition: background 0.3s ease;
        }
        
        body.dark-mode .preview-section {
            background: #2d3d4a;
            border-left-color: #4a90e2;
        }
        
        .preview-title {
            font-size: 14px;
            color: #1976d2;
            font-weight: 600;
            margin-bottom: 10px;
            transition: color 0.3s ease;
        }
        
        body.dark-mode .preview-title {
            color: #64b5f6;
        }
        
        .preview-formula {
            font-size: 18px;
            font-weight: bold;
            color: #0d47a1;
            font-family: 'Courier New', monospace;
            transition: color 0.3s ease;
        }
        
        body.dark-mode .preview-formula {
            color: #90caf9;
        }
        
        .preview-details {
            margin-top: 10px;
            font-size: 14px;
            color: #1565c0;
            transition: color 0.3s ease;
        }
        
        body.dark-mode .preview-details {
            color: #81d4fa;
        }
        
        /* ÊåâÈíÆÊ†∑Âºè */
        .action-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .action-btn:active {
            transform: translateY(0);
        }
        
        /* ÁªìÊûúÊòæÁ§∫ */
        .result-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #28a745;
            transition: background 0.3s ease;
        }
        
        body.dark-mode .result-section {
            background: #2d3d4a;
            border-left-color: #4caf50;
        }
        
        .result-section.error {
            border-left-color: #dc3545;
        }
        
        body.dark-mode .result-section.error {
            border-left-color: #ef5350;
        }
        
        .result-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .result-success {
            color: #28a745;
        }
        
        .result-error {
            color: #dc3545;
        }
        
        .result-content {
            line-height: 1.6;
        }
        
        .formula-display {
            background: white;
            padding: 12px 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            border: 1px solid #dee2e6;
        }
        
        .valence-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
        }
        
        .valence-item {
            background: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 13px;
            border: 1px solid #dee2e6;
        }
        
        @media (max-width: 600px) {
            .element-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .content {
                padding: 15px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="page-header">
            <a href="index.html" class="back-btn">‚Üê ËøîÂõûÈ¶ñÈ°µ</a>
            <div class="page-title">ÂåñÂ≠¶ÂºèÊ£ÄÈ™å</div>
            <button class="mode-switch-btn" onclick="switchMode()" id="modeSwitchBtn">ÂàáÊç¢Âà∞Âø´ÈÄüËæìÂÖ•</button>
        </div>
        
        <div class="content">
            <!-- Âø´ÈÄüËæìÂÖ•Ê®°Âºè -->
            <div class="quick-input-section" id="quickInputSection">
                <div class="input-section">
                    <label class="input-label">ËæìÂÖ•ÂåñÂ≠¶Âºè</label>
                    <input type="text" class="formula-input" id="formulaInput" placeholder="ËæìÂÖ•ÂåñÂ≠¶ÂºèÔºåÂ¶ÇÔºöH2O, NaCl, CO2">
                    <div class="input-hint">
                        ÊèêÁ§∫ÔºöÊîØÊåÅÂ∏∏ËßÅÂåñÂ≠¶ÂºèËæìÂÖ•ÔºåÁ≥ªÁªü‰ºöËá™Âä®ËØÜÂà´ÂÖÉÁ¥†ÂíåÊ†π
                    </div>
                </div>
                
                <button class="action-btn" onclick="validateQuickInput()">ÂºÄÂßãÊ£ÄÈ™å</button>
            </div>
            
            <!-- Âç°ÁâáÊ®°Âºè -->
            <div class="card-mode-section" id="cardModeSection">
            <!-- Â∏∏ËßÅÊ∞î‰ΩìÂàÜÁ±ª -->
            <div class="category-section" id="gasCategory">
                <div class="category-header" onclick="toggleCategory('gasCategory')">
                    <div class="category-title">
                        <span class="category-icon">üí®</span>
                        Â∏∏ËßÅÊ∞î‰ΩìÔºà‰ºòÂÖàÊòæÁ§∫Ôºâ
                    </div>
                    <div class="toggle-icon">‚ñº</div>
                </div>
                <div class="category-content">
                    <div class="element-grid">
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Ê∞¢</span>
                                <span class="element-symbol">H</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="H-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('H', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('H', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Ê∞ß</span>
                                <span class="element-symbol">O</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="O-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('O', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('O', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Ê∞Æ</span>
                                <span class="element-symbol">N</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="N-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('N', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('N', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Ê∞Ø</span>
                                <span class="element-symbol">Cl</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="Cl-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('Cl', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('Cl', 1)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ‰∏Ä‰ª∑ÂÖÉÁ¥†ÂàÜÁ±ª -->
            <div class="category-section" id="valence1Category">
                <div class="category-header" onclick="toggleCategory('valence1Category')">
                    <div class="category-title">
                        <span class="category-icon">1Ô∏è‚É£</span>
                        ‰∏Ä‰ª∑ÂÖÉÁ¥†ÔºàÊ∞¢Ê∞ØÈíæÈí†Èì∂Ôºâ
                    </div>
                    <div class="toggle-icon">‚ñº</div>
                </div>
                <div class="category-content">
                    <div class="element-grid">
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Èíæ</span>
                                <span class="element-symbol">K</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="K-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('K', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('K', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Èí†</span>
                                <span class="element-symbol">Na</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="Na-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('Na', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('Na', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Èì∂</span>
                                <span class="element-symbol">Ag</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="Ag-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('Ag', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('Ag', 1)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ‰∫å‰ª∑ÂÖÉÁ¥†ÂàÜÁ±ª -->
            <div class="category-section" id="valence2Category">
                <div class="category-header" onclick="toggleCategory('valence2Category')">
                    <div class="category-title">
                        <span class="category-icon">2Ô∏è‚É£</span>
                        ‰∫å‰ª∑ÂÖÉÁ¥†ÔºàÊ∞ßÈíôÈí°ÈïÅÈîåÈìúÊ±ûÔºâ
                    </div>
                    <div class="toggle-icon">‚ñº</div>
                </div>
                <div class="category-content">
                    <div class="element-grid">
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Èíô</span>
                                <span class="element-symbol">Ca</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="Ca-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('Ca', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('Ca', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">ÈïÅ</span>
                                <span class="element-symbol">Mg</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="Mg-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('Mg', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('Mg', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Èîå</span>
                                <span class="element-symbol">Zn</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="Zn-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('Zn', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('Zn', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Èí°</span>
                                <span class="element-symbol">Ba</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="Ba-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('Ba', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('Ba', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Èìú</span>
                                <span class="element-symbol">Cu</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="Cu-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('Cu', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('Cu', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Ê±û</span>
                                <span class="element-symbol">Hg</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="Hg-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('Hg', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('Hg', 1)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ÂÖ∂‰ªñÂ∏∏ËßÅÂÖÉÁ¥†ÂàÜÁ±ª -->
            <div class="category-section" id="otherCommonCategory">
                <div class="category-header" onclick="toggleCategory('otherCommonCategory')">
                    <div class="category-title">
                        <span class="category-icon">üî¨</span>
                        ÂÖ∂‰ªñÂ∏∏ËßÅÂÖÉÁ¥†Ôºà‰∏âÈìùÂõõÁ°Ö‰∫îÊ∞ÆÁ£∑‰∫å‰∏âÈìÅ‰∫åÂõõÁ¢≥‰∫åÂõõÂÖ≠Á°´Ôºâ
                    </div>
                    <div class="toggle-icon">‚ñº</div>
                </div>
                <div class="category-content">
                    <div class="element-grid">
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Èìù</span>
                                <span class="element-symbol">Al</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="Al-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('Al', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('Al', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Á°Ö</span>
                                <span class="element-symbol">Si</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="Si-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('Si', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('Si', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Á£∑</span>
                                <span class="element-symbol">P</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="P-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('P', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('P', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">ÈìÅ</span>
                                <span class="element-symbol">Fe</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="Fe-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('Fe', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('Fe', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Á¢≥</span>
                                <span class="element-symbol">C</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="C-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('C', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('C', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Á°´</span>
                                <span class="element-symbol">S</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="S-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('S', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('S', 1)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Â∏∏ËßÅÊ†πÂàÜÁ±ª -->
            <div class="category-section" id="radicalCategory">
                <div class="category-header" onclick="toggleCategory('radicalCategory')">
                    <div class="category-title">
                        <span class="category-icon">üß™</span>
                        Â∏∏ËßÅÊ†πÔºà‰ºòÂÖàÂåπÈÖçÔºâ
                    </div>
                    <div class="toggle-icon">‚ñº</div>
                </div>
                <div class="category-content">
                    <div class="element-grid">
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Ê∞¢Ê∞ßÊ†π</span>
                                <span class="element-symbol">OH</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="OH-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('OH', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('OH', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Á°ùÈÖ∏Ê†π</span>
                                <span class="element-symbol">NO‚ÇÉ</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="NO3-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('NO3', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('NO3', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Á°´ÈÖ∏Ê†π</span>
                                <span class="element-symbol">SO‚ÇÑ</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="SO4-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('SO4', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('SO4', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Á¢≥ÈÖ∏Ê†π</span>
                                <span class="element-symbol">CO‚ÇÉ</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="CO3-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('CO3', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('CO3', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">ÈìµÊ†π</span>
                                <span class="element-symbol">NH‚ÇÑ</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="NH4-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('NH4', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('NH4', 1)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ‰∏çÂ∏∏ËßÅÂÖÉÁ¥†ÂàÜÁ±ª -->
            <div class="category-section" id="rareCategory">
                <div class="category-header" onclick="toggleCategory('rareCategory')">
                    <div class="category-title">
                        <span class="category-icon">‚öóÔ∏è</span>
                        ‰∏çÂ∏∏ËßÅÂÖÉÁ¥†ÔºàËæÉÂ∞ë‰ΩøÁî®Ôºâ
                    </div>
                    <div class="toggle-icon">‚ñº</div>
                </div>
                <div class="category-content">
                    <div class="element-grid">
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Èî∞</span>
                                <span class="element-symbol">Mn</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="Mn-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('Mn', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('Mn', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Ê∫¥</span>
                                <span class="element-symbol">Br</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="Br-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('Br', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('Br', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Á¢ò</span>
                                <span class="element-symbol">I</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="I-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('I', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('I', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Ê∞ü</span>
                                <span class="element-symbol">F</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="F-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('F', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('F', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">Èáë</span>
                                <span class="element-symbol">Au</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="Au-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('Au', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('Au', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-card">
                            <div class="element-info">
                                <span class="element-name">ÈìÇ</span>
                                <span class="element-symbol">Pt</span>
                            </div>
                            <div class="element-control">
                                <span class="quantity-display" id="Pt-count">0</span>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="updateElement('Pt', -1)">‚àí</button>
                                    <button class="control-btn" onclick="updateElement('Pt', 1)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ÂÆûÊó∂È¢ÑËßà -->
            <div class="preview-section" id="previewSection" style="display: none;">
                <div class="preview-title">ÂÆûÊó∂È¢ÑËßà</div>
                <div class="preview-formula" id="previewFormula"></div>
                <div class="preview-details" id="previewDetails"></div>
            </div>
            
            <!-- Ê£ÄÈ™åÊåâÈíÆ -->
            <button class="action-btn" onclick="validateFormula()">ÂºÄÂßãÊ£ÄÈ™å</button>
            
            <!-- ÁªìÊûúÊòæÁ§∫ -->
            <div class="result-section" id="resultSection" style="display: none;">
                <div class="result-title" id="resultTitle"></div>
                <div class="result-content" id="resultContent"></div>
            </div>
            </div>
        </div>
    </div>

    <script>
        // ËÆæÁΩÆÂ≠òÂÇ®ÈîÆ
        const SETTINGS_KEY = 'chemistry_settings';
        
        // ÂΩìÂâçÊ®°Âºè
        let currentMode = 'card';
        
        // Âä†ËΩΩËÆæÁΩÆ
        function loadSettings() {
            const savedSettings = localStorage.getItem(SETTINGS_KEY);
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                currentMode = settings.defaultMode || 'card';
                updateModeButton();
            }
        }
        
        // ÂàáÊç¢Ê®°Âºè
        function switchMode() {
            currentMode = currentMode === 'card' ? 'input' : 'card';
            saveMode();
            applyMode();
        }
        
        // ‰øùÂ≠òÊ®°ÂºèËÆæÁΩÆ
        function saveMode() {
            const savedSettings = localStorage.getItem(SETTINGS_KEY);
            const settings = savedSettings ? JSON.parse(savedSettings) : {};
            settings.defaultMode = currentMode;
            localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
        }
        
        // Êõ¥Êñ∞Ê®°ÂºèÊåâÈíÆÊñáÊú¨
        function updateModeButton() {
            const btn = document.getElementById('modeSwitchBtn');
            if (btn) {
                btn.textContent = currentMode === 'card' ? 'ÂàáÊç¢Âà∞Âø´ÈÄüËæìÂÖ•' : 'ÂàáÊç¢Âà∞Âç°ÁâáÊ®°Âºè';
            }
        }
        
        // Â∫îÁî®Ê∑±Ëâ≤Ê®°Âºè
        function applyDarkMode() {
            const savedSettings = localStorage.getItem(SETTINGS_KEY);
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                if (settings.darkMode) {
                    document.body.classList.add('dark-mode');
                }
            }
        }
        
        // ÂÖÉÁ¥†Êï∞ÊçÆÂ∫ì
        const elementsData = {
            'H': { name: 'Ê∞¢', symbol: 'H', valences: [1], electronegativity: 2.20 },
            'O': { name: 'Ê∞ß', symbol: 'O', valences: [-2], electronegativity: 3.44 },
            'C': { name: 'Á¢≥', symbol: 'C', valences: [4, 2, -4], electronegativity: 2.55 },
            'N': { name: 'Ê∞Æ', symbol: 'N', valences: [-3, 1, 2, 3, 4, 5], electronegativity: 3.04 },
            'Na': { name: 'Èí†', symbol: 'Na', valences: [1], electronegativity: 0.93 },
            'K': { name: 'Èíæ', symbol: 'K', valences: [1], electronegativity: 0.82 },
            'Ca': { name: 'Èíô', symbol: 'Ca', valences: [2], electronegativity: 1.00 },
            'Mg': { name: 'ÈïÅ', symbol: 'Mg', valences: [2], electronegativity: 1.31 },
            'Cl': { name: 'Ê∞Ø', symbol: 'Cl', valences: [-1, 1, 3, 5, 7], electronegativity: 3.16 },
            'S': { name: 'Á°´', symbol: 'S', valences: [-2, 4, 6], electronegativity: 2.58 },
            'P': { name: 'Á£∑', symbol: 'P', valences: [-3, 3, 5], electronegativity: 2.19 },
            'Ag': { name: 'Èì∂', symbol: 'Ag', valences: [1], electronegativity: 1.93 },
            'Zn': { name: 'Èîå', symbol: 'Zn', valences: [2], electronegativity: 1.65 },
            'Ba': { name: 'Èí°', symbol: 'Ba', valences: [2], electronegativity: 0.89 },
            'Cu': { name: 'Èìú', symbol: 'Cu', valences: [1, 2], electronegativity: 1.90 },
            'Hg': { name: 'Ê±û', symbol: 'Hg', valences: [1, 2], electronegativity: 2.00 },
            'Al': { name: 'Èìù', symbol: 'Al', valences: [3], electronegativity: 1.61 },
            'Si': { name: 'Á°Ö', symbol: 'Si', valences: [4], electronegativity: 1.90 },
            'Fe': { name: 'ÈìÅ', symbol: 'Fe', valences: [2, 3], electronegativity: 1.83 },
            'Mn': { name: 'Èî∞', symbol: 'Mn', valences: [2, 3, 4, 6, 7], electronegativity: 1.55 },
            'Br': { name: 'Ê∫¥', symbol: 'Br', valences: [-1, 1, 3, 5, 7], electronegativity: 2.96 },
            'I': { name: 'Á¢ò', symbol: 'I', valences: [-1, 1, 3, 5, 7], electronegativity: 2.66 },
            'F': { name: 'Ê∞ü', symbol: 'F', valences: [-1], electronegativity: 3.98 },
            'Au': { name: 'Èáë', symbol: 'Au', valences: [1, 3], electronegativity: 2.54 },
            'Pt': { name: 'ÈìÇ', symbol: 'Pt', valences: [2, 4], electronegativity: 2.28 },
            'OH': { name: 'Ê∞¢Ê∞ßÊ†π', symbol: 'OH', valences: [-1], electronegativity: 3.44 },
            'NO3': { name: 'Á°ùÈÖ∏Ê†π', symbol: 'NO‚ÇÉ', valences: [-1], electronegativity: 3.44 },
            'SO4': { name: 'Á°´ÈÖ∏Ê†π', symbol: 'SO‚ÇÑ', valences: [-2], electronegativity: 3.44 },
            'CO3': { name: 'Á¢≥ÈÖ∏Ê†π', symbol: 'CO‚ÇÉ', valences: [-2], electronegativity: 3.44 },
            'NH4': { name: 'ÈìµÊ†π', symbol: 'NH‚ÇÑ', valences: [1], electronegativity: 2.20 }
        };

        // Â∏∏ËßÅÂåñÂêàÁâ©Â∫ì
        const commonCompounds = {
            'H‚ÇÇO': { name: 'Ê∞¥', formula: 'H‚ÇÇO', valences: { H: 1, O: -2 } },
            'CO‚ÇÇ': { name: '‰∫åÊ∞ßÂåñÁ¢≥', formula: 'CO‚ÇÇ', valences: { C: 4, O: -2 } },
            'CO': { name: '‰∏ÄÊ∞ßÂåñÁ¢≥', formula: 'CO', valences: { C: 2, O: -2 } },
            'NaCl': { name: 'Ê∞ØÂåñÈí†', formula: 'NaCl', valences: { Na: 1, Cl: -1 } },
            'HCl': { name: 'ÁõêÈÖ∏', formula: 'HCl', valences: { H: 1, Cl: -1 } },
            'NH‚ÇÉ': { name: 'Ê∞®', formula: 'NH‚ÇÉ', valences: { N: -3, H: 1 } },
            'CH‚ÇÑ': { name: 'Áî≤ÁÉ∑', formula: 'CH‚ÇÑ', valences: { C: -4, H: 1 } },
            'CaCO‚ÇÉ': { name: 'Á¢≥ÈÖ∏Èíô', formula: 'CaCO‚ÇÉ', valences: { Ca: 2, C: 4, O: -2 } },
            'H‚ÇÇSO‚ÇÑ': { name: 'Á°´ÈÖ∏', formula: 'H‚ÇÇSO‚ÇÑ', valences: { H: 1, S: 6, O: -2 } },
            'NaOH': { name: 'Ê∞¢Ê∞ßÂåñÈí†', formula: 'NaOH', valences: { Na: 1, O: -2, H: 1 } },
            'Na‚ÇÇCO‚ÇÉ': { name: 'Á¢≥ÈÖ∏Èí†', formula: 'Na‚ÇÇCO‚ÇÉ', valences: { Na: 1, C: 4, O: -2 } },
            'H‚ÇÇO‚ÇÇ': { name: 'ËøáÊ∞ßÂåñÊ∞¢', formula: 'H‚ÇÇO‚ÇÇ', valences: { H: 1, O: -1 } },
            'SO‚ÇÇ': { name: '‰∫åÊ∞ßÂåñÁ°´', formula: 'SO‚ÇÇ', valences: { S: 4, O: -2 } },
            'SO‚ÇÉ': { name: '‰∏âÊ∞ßÂåñÁ°´', formula: 'SO‚ÇÉ', valences: { S: 6, O: -2 } },
            'Na‚ÇÇO': { name: 'Ê∞ßÂåñÈí†', formula: 'Na‚ÇÇO', valences: { Na: 1, O: -2 } },
            'CaCl‚ÇÇ': { name: 'Ê∞ØÂåñÈíô', formula: 'CaCl‚ÇÇ', valences: { Ca: 2, Cl: -1 } },
            'Na‚ÇÇSO‚ÇÑ': { name: 'Á°´ÈÖ∏Èí†', formula: 'Na‚ÇÇSO‚ÇÑ', valences: { Na: 1, S: 6, O: -2 } },
            'H‚ÇÇCO‚ÇÉ': { name: 'Á¢≥ÈÖ∏', formula: 'H‚ÇÇCO‚ÇÉ', valences: { H: 1, C: 4, O: -2 } },
            'NH‚ÇÑCl': { name: 'Ê∞ØÂåñÈìµ', formula: 'NH‚ÇÑCl', valences: { NH4: 1, Cl: -1 } },
            'NH‚ÇÑNO‚ÇÉ': { name: 'Á°ùÈÖ∏Èìµ', formula: 'NH‚ÇÑNO‚ÇÉ', valences: { NH4: 1, NO3: -1 } },
            '(NH‚ÇÑ)‚ÇÇSO‚ÇÑ': { name: 'Á°´ÈÖ∏Èìµ', formula: '(NH‚ÇÑ)‚ÇÇSO‚ÇÑ', valences: { NH4: 1, SO4: -2 } }
        };

        // ÂΩìÂâçÈÄâÊã©ÁöÑÂÖÉÁ¥†
        let selectedElements = {};

        // ÂàùÂßãÂåñ
        function init() {
            loadSettings();
            applyDarkMode();
            applyMode();
            Object.keys(elementsData).forEach(element => {
                selectedElements[element] = 0;
            });
            updatePreview();
        }
        
        // Â∫îÁî®Ê®°ÂºèËÆæÁΩÆ
        function applyMode() {
            const quickInputSection = document.getElementById('quickInputSection');
            const cardModeSection = document.getElementById('cardModeSection');
            
            if (currentMode === 'input') {
                quickInputSection.classList.add('active');
                cardModeSection.classList.add('hidden');
            } else {
                quickInputSection.classList.remove('active');
                cardModeSection.classList.remove('hidden');
            }
            updateModeButton();
        }

        // ÂàÜÁ±ªÊî∂Ëµ∑/ÈáäÊîæ
        function toggleCategory(categoryId) {
            const category = document.getElementById(categoryId);
            category.classList.toggle('collapsed');
        }

        // Êõ¥Êñ∞ÂÖÉÁ¥†Êï∞Èáè
        function updateElement(element, delta) {
            const newCount = selectedElements[element] + delta;
            if (newCount >= 0 && newCount <= 99) {
                selectedElements[element] = newCount;
                const countElement = document.getElementById(element + '-count');
                if (countElement) {
                    countElement.textContent = newCount;
                }
                updatePreview();
            }
        }

        // Êõ¥Êñ∞È¢ÑËßàÔºàÊåâÂåñÂ≠¶Âºè‰π¶ÂÜôËßÑËåÉÊòæÁ§∫Ôºâ
        function updatePreview() {
            const elements = {};
            Object.entries(selectedElements).forEach(([element, count]) => {
                if (count > 0) elements[element] = count;
            });

            if (Object.keys(elements).length === 0) {
                document.getElementById('previewSection').style.display = 'none';
                return;
            }

            document.getElementById('previewSection').style.display = 'block';
            
            const formula = generateFormula(elements);
            
            let details = '';
            Object.entries(elements).forEach(([element, count]) => {
                details += `${elementsData[element].name}: ${count} `;
            });
            
            document.getElementById('previewFormula').textContent = formula;
            document.getElementById('previewDetails').textContent = details.trim();
        }

        // Êï∞Â≠óËΩ¨‰∏ãÊ†á
        Number.prototype.toSubscript = function() {
            const subscripts = {
                '0': '‚ÇÄ', '1': '‚ÇÅ', '2': '‚ÇÇ', '3': '‚ÇÉ', '4': '‚ÇÑ',
                '5': '‚ÇÖ', '6': '‚ÇÜ', '7': '‚Çá', '8': '‚Çà', '9': '‚Çâ'
            };
            return this.toString().split('').map(digit => subscripts[digit] || digit).join('');
        };

        // È™åËØÅÂåñÂ≠¶Âºè
        function validateFormula() {
            const elements = {};
            Object.entries(selectedElements).forEach(([element, count]) => {
                if (count > 0) elements[element] = count;
            });
            
            if (Object.keys(elements).length === 0) {
                showResult(false, 'ËØ∑Ëá≥Â∞ëÈÄâÊã©‰∏Ä‰∏™ÂÖÉÁ¥†ÔºÅ');
                return;
            }

            const formula = generateFormula(elements);
            const result = validateCompound(elements, formula);
            showResult(result.success, result.message, result.details);
        }
        
        // Âø´ÈÄüËæìÂÖ•Ê®°ÂºèÈ™åËØÅ
        function validateQuickInput() {
            const formulaInput = document.getElementById('formulaInput');
            const formula = formulaInput.value.trim();
            
            if (!formula) {
                showResult(false, 'ËØ∑ËæìÂÖ•ÂåñÂ≠¶ÂºèÔºÅ');
                return;
            }
            
            const elements = parseFormulaInput(formula);
            
            if (Object.keys(elements).length === 0) {
                showResult(false, 'Êó†Ê≥ïËØÜÂà´ÂåñÂ≠¶ÂºèÔºåËØ∑Ê£ÄÊü•ËæìÂÖ•ÔºÅ');
                return;
            }
            
            const result = validateCompound(elements, formula);
            showResult(result.success, result.message, result.details);
        }
        
        // Ëß£ÊûêÂø´ÈÄüËæìÂÖ•ÁöÑÂåñÂ≠¶Âºè
        function parseFormulaInput(formula) {
            const elements = {};
            
            const regex = /([A-Z][a-z]*)(\d*)/g;
            let match;
            
            while ((match = regex.exec(formula)) !== null) {
                const element = match[1];
                const count = match[2] ? parseInt(match[2]) : 1;
                elements[element] = (elements[element] || 0) + count;
            }
            
            return elements;
        }

        // ÁîüÊàêÂåñÂ≠¶ÂºèÔºàÊåâÂåñÂ≠¶Âºè‰π¶ÂÜôËßÑËåÉÔºâ
        function generateFormula(elements) {
            const elementEntries = Object.entries(elements).filter(([_, count]) => count > 0);
            
            if (elementEntries.length === 0) return '';
            
            // ÁâπÊÆäÊÉÖÂÜµÔºöNH‚ÇÉÔºàÊ∞®Ôºâ
            if (elementEntries.length === 2 && 
                elementEntries.some(([e, c]) => e === 'N' && c === 1) &&
                elementEntries.some(([e, c]) => e === 'H' && c === 3)) {
                return 'NH‚ÇÉ';
            }
            
            // ÁâπÊÆäÊÉÖÂÜµÔºö(NH‚ÇÑ)‚ÇÇSO‚ÇÑÔºàÁ°´ÈÖ∏ÈìµÔºâ
            if (elementEntries.length === 2 && 
                elementEntries.some(([e, c]) => e === 'NH4' && c === 2) &&
                elementEntries.some(([e, c]) => e === 'SO4' && c === 1)) {
                return '(NH‚ÇÑ)‚ÇÇSO‚ÇÑ';
            }
            
            // ÁâπÊÆäÊÉÖÂÜµÔºöNH‚ÇÑClÔºàÊ∞ØÂåñÈìµÔºâ
            if (elementEntries.length === 2 && 
                elementEntries.some(([e, c]) => e === 'NH4' && c === 1) &&
                elementEntries.some(([e, c]) => e === 'Cl' && c === 1)) {
                return 'NH‚ÇÑCl';
            }
            
            // ÁâπÊÆäÊÉÖÂÜµÔºöNH‚ÇÑNO‚ÇÉÔºàÁ°ùÈÖ∏ÈìµÔºâ
            if (elementEntries.length === 2 && 
                elementEntries.some(([e, c]) => e === 'NH4' && c === 1) &&
                elementEntries.some(([e, c]) => e === 'NO3' && c === 1)) {
                return 'NH‚ÇÑNO‚ÇÉ';
            }
            
            // ÁâπÊÆäÊÉÖÂÜµÔºö(NH‚ÇÑ)‚ÇÇCO‚ÇÉÔºàÁ¢≥ÈÖ∏ÈìµÔºâ
            if (elementEntries.length === 2 && 
                elementEntries.some(([e, c]) => e === 'NH4' && c === 2) &&
                elementEntries.some(([e, c]) => e === 'CO3' && c === 1)) {
                return '(NH‚ÇÑ)‚ÇÇCO‚ÇÉ';
            }
            
            // ÈìµÊ†πÊï∞ÈáèÂ§ß‰∫é1Êó∂ÈúÄË¶ÅÂä†Êã¨Âè∑
            const nh4Entry = elementEntries.find(([e, _]) => e === 'NH4');
            if (nh4Entry && nh4Entry[1] > 1) {
                const nh4Count = nh4Entry[1];
                const otherElements = elementEntries.filter(([e, _]) => e !== 'NH4');
                
                if (otherElements.length > 0) {
                    let formula = `(NH‚ÇÑ)${nh4Count.toSubscript()}`;
                    otherElements.forEach(([element, count]) => {
                        const symbol = elementsData[element].symbol;
                        if (count === 1) {
                            formula += symbol;
                        } else {
                            formula += symbol + count.toSubscript();
                        }
                    });
                    return formula;
                }
            }
            
            // ÊåâÁÖßÂåñÂ≠¶Âºè‰π¶ÂÜôËßÑËåÉÊéíÂ∫èÔºö
            // 1. ÈáëÂ±ûÂú®ÂâçÔºåÈùûÈáëÂ±ûÂú®Âêé
            // 2. Ê≠£‰ª∑Âú®ÂâçÔºåË¥ü‰ª∑Âú®Âêé
            // 3. Ê∞¢ÂåñÁâ©‰æãÂ§ñÔºöHÈÄöÂ∏∏Âú®ÂâçÔºàÈô§‰∫ÜNH‚ÇÉÁ≠âÁâπÊÆäÊÉÖÂÜµÔºâ
            const sortedElements = elementEntries.sort(([elem1, count1], [elem2, count2]) => {
                const data1 = elementsData[elem1];
                const data2 = elementsData[elem2];
                
                const metals = ['Na', 'K', 'Ca', 'Mg', 'Ag', 'Zn', 'Ba', 'Cu', 'Hg', 'Al', 'Fe', 'Mn', 'Au', 'Pt'];
                const isMetal1 = metals.includes(elem1);
                const isMetal2 = metals.includes(elem2);
                if (isMetal1 && !isMetal2) return -1;
                if (!isMetal1 && isMetal2) return 1;
                
                if (data1.electronegativity !== data2.electronegativity) {
                    return data1.electronegativity - data2.electronegativity;
                }
                
                return elem1.localeCompare(elem2);
            });
            
            let formula = '';
            sortedElements.forEach(([element, count]) => {
                const symbol = elementsData[element].symbol;
                
                if (count === 1) {
                    formula += symbol;
                } else {
                    formula += symbol + count.toSubscript();
                }
            });
            
            return formula;
        }

        // È™åËØÅÂåñÂêàÁâ©
        function validateCompound(elements, formula) {
            // Ê£ÄÊü•Â∏∏ËßÅÂåñÂêàÁâ©Â∫ì
            const compoundKey = Object.keys(commonCompounds).find(key => {
                const compound = commonCompounds[key];
                return compound.formula === formula;
            });
            
            if (compoundKey) {
                const compound = commonCompounds[compoundKey];
                return {
                    success: true,
                    message: `‚úÖ ÂèØ‰ª•ÁªÑÊàêÂåñÂêàÁâ©ÔºÅ`,
                    details: {
                        formula: formula,
                        name: compound.name,
                        valences: compound.valences,
                        elements: elements,
                        isCommon: true
                    }
                };
            }

            // Êô∫ËÉΩÂåñÂêà‰ª∑ÂåπÈÖç
            const valenceResult = matchValences(elements);
            if (valenceResult.success) {
                return {
                    success: true,
                    message: `‚úÖ ÂèØ‰ª•ÁªÑÊàêÂåñÂêàÁâ©ÔºÅ`,
                    details: {
                        ...valenceResult,
                        elements: elements
                    }
                };
            }

            // Êèê‰æõÂª∫ËÆÆ
            const suggestions = generateSuggestions(elements);
            return {
                success: false,
                message: `‚ùå Êó†Ê≥ïÁªÑÊàêÁ®≥ÂÆöÂåñÂêàÁâ©`,
                details: { suggestions: suggestions }
            };
        }

        // ÂåñÂêà‰ª∑ÂåπÈÖç
        function matchValences(elements) {
            const elementValences = {};
            Object.keys(elements).forEach(element => {
                if (elementsData[element] && elementsData[element].valences) {
                    elementValences[element] = elementsData[element].valences;
                }
            });

            if (Object.keys(elementValences).length === 0) {
                return { success: false };
            }

            // Â∞ùËØïÊâæÂà∞ÂåñÂêà‰ª∑Âπ≥Ë°°ÁöÑÁªÑÂêà
            const combinations = generateValenceCombinations(elementValences);
            
            for (const combination of combinations) {
                const balance = calculateValenceBalance(elements, combination);
                if (balance === 0) {
                    const formula = generateFormula(elements);
                    return {
                        success: true,
                        formula: formula,
                        name: getCompoundName(formula, elements),
                        valences: combination
                    };
                }
            }
            
            return { success: false };
        }

        // ÁîüÊàêÂåñÂêà‰ª∑ÁªÑÂêà
        function generateValenceCombinations(elementValences) {
            const combinations = [];
            const elements = Object.keys(elementValences);
            
            function backtrack(index, current) {
                if (index === elements.length) {
                    combinations.push({...current});
                    return;
                }
                
                const element = elements[index];
                for (const valence of elementValences[element]) {
                    current[element] = valence;
                    backtrack(index + 1, current);
                }
            }
            
            backtrack(0, {});
            return combinations;
        }

        // ËÆ°ÁÆóÂåñÂêà‰ª∑Âπ≥Ë°°
        function calculateValenceBalance(elements, valences) {
            let total = 0;
            Object.entries(elements).forEach(([element, count]) => {
                if (valences[element] !== undefined) {
                    total += valences[element] * count;
                }
            });
            return total;
        }

        // Ëé∑ÂèñÂåñÂêàÁâ©ÂêçÁß∞ÔºàÁ¨¶ÂêàÂåñÂ≠¶ÂëΩÂêçËßÑËåÉÔºâ
        function getCompoundName(formula, elements) {
            const specialNames = {
                'H‚ÇÇO': 'Ê∞¥',
                'H‚ÇÇO‚ÇÇ': 'ËøáÊ∞ßÂåñÊ∞¢',
                'CO‚ÇÇ': '‰∫åÊ∞ßÂåñÁ¢≥',
                'CO': '‰∏ÄÊ∞ßÂåñÁ¢≥',
                'NaCl': 'Ê∞ØÂåñÈí†',
                'HCl': 'ÁõêÈÖ∏',
                'NH‚ÇÉ': 'Ê∞®',
                'CH‚ÇÑ': 'Áî≤ÁÉ∑',
                'CaCO‚ÇÉ': 'Á¢≥ÈÖ∏Èíô',
                'H‚ÇÇSO‚ÇÑ': 'Á°´ÈÖ∏',
                'NaOH': 'Ê∞¢Ê∞ßÂåñÈí†',
                'Na‚ÇÇCO‚ÇÉ': 'Á¢≥ÈÖ∏Èí†',
                'SO‚ÇÇ': '‰∫åÊ∞ßÂåñÁ°´',
                'SO‚ÇÉ': '‰∏âÊ∞ßÂåñÁ°´',
                'Na‚ÇÇO': 'Ê∞ßÂåñÈí†',
                'CaCl‚ÇÇ': 'Ê∞ØÂåñÈíô',
                'Na‚ÇÇSO‚ÇÑ': 'Á°´ÈÖ∏Èí†',
                'H‚ÇÇCO‚ÇÉ': 'Á¢≥ÈÖ∏',
                'NH‚ÇÑCl': 'Ê∞ØÂåñÈìµ',
                'NH‚ÇÑNO‚ÇÉ': 'Á°ùÈÖ∏Èìµ',
                '(NH‚ÇÑ)‚ÇÇSO‚ÇÑ': 'Á°´ÈÖ∏Èìµ'
            };

            if (specialNames[formula]) {
                return specialNames[formula];
            }

            const elementEntries = Object.entries(elements).filter(([_, count]) => count > 0);
            
            if (elementEntries.length === 0) return '';
            
            // Ê∞¢Ê∞ßÂåñÁâ©ÔºàÈáëÂ±û + OHÔºâ
            if (elementEntries.length === 2) {
                const hasOH = elementEntries.some(([e, _]) => e === 'OH');
                const metal = elementEntries.find(([e, _]) => ['Na', 'K', 'Ca', 'Mg', 'Ag', 'Zn', 'Ba', 'Cu', 'Hg', 'Al', 'Fe', 'Mn', 'Au', 'Pt'].includes(e));
                
                if (hasOH && metal) {
                    const metalCount = elements[metal[0]];
                    const metalName = elementsData[metal[0]].name;
                    return `Ê∞¢Ê∞ßÂåñ${metalName}${metalCount > 1 ? metalCount.toSubscript() : ''}`;
                }
            }
            
            // ÈÖ∏ÔºàH + ÈÖ∏Ê†πÔºâ
            if (elementEntries.length === 2) {
                const hasH = elementEntries.some(([e, c]) => e === 'H' && c > 0);
                const acidRoot = elementEntries.find(([e, _]) => ['OH', 'NO3', 'SO4', 'CO3'].includes(e));
                
                if (hasH && acidRoot && acidRoot[0] !== 'OH') {
                    const rootName = elementsData[acidRoot[0]].name;
                    return rootName.replace('Ê†π', '');
                }
            }
            
            // ÈìµÁõêÔºàNH‚ÇÑ + ÈÖ∏Ê†πÔºâ
            if (elementEntries.length === 2) {
                const hasNH4 = elementEntries.some(([e, c]) => e === 'NH4' && c > 0);
                const acidRoot = elementEntries.find(([e, _]) => ['OH', 'NO3', 'SO4', 'CO3', 'Cl'].includes(e));
                
                if (hasNH4 && acidRoot) {
                    const rootName = elementsData[acidRoot[0]].name;
                    const acidRootCount = elements[acidRoot[0]];
                    
                    if (acidRoot[0] === 'Cl') {
                        return 'Ê∞ØÂåñÈìµ';
                    }
                    
                    if (acidRootCount > 1) {
                        return `${rootName.replace('Ê†π', '')}Èìµ`;
                    }
                    return `${rootName.replace('Ê†π', '')}Èìµ`;
                }
            }
            
            // Ê∞ßÂåñÁâ©ÔºàÈáëÂ±û + OÔºâ
            if (elementEntries.length === 2) {
                const hasO = elementEntries.some(([e, c]) => e === 'O' && c > 0);
                const metal = elementEntries.find(([e, _]) => ['Na', 'K', 'Ca', 'Mg', 'Ag', 'Zn', 'Ba', 'Cu', 'Hg', 'Al', 'Fe', 'Mn', 'Au', 'Pt'].includes(e));
                
                if (hasO && metal) {
                    const oCount = elements['O'];
                    const metalName = elementsData[metal[0]].name;
                    if (oCount === 1) return `Ê∞ßÂåñ${metalName}`;
                    return `${oCount.toSubscript()}Ê∞ßÂåñ${metalName}`;
                }
            }
            
            // ÈùûÈáëÂ±ûÊ∞ßÂåñÁâ©ÔºàÈùûÈáëÂ±û + OÔºâ
            if (elementEntries.length === 2) {
                const hasO = elementEntries.some(([e, c]) => e === 'O' && c > 0);
                const nonMetal = elementEntries.find(([e, _]) => 
                    ['C', 'N', 'S', 'P', 'Si', 'Br', 'I', 'F'].includes(e) && e !== 'O'
                );
                
                if (hasO && nonMetal) {
                    const oCount = elements['O'];
                    const nonMetalName = elementsData[nonMetal[0]].name;
                    if (oCount === 1) return `‰∏ÄÊ∞ßÂåñ${nonMetalName}`;
                    return `${oCount.toSubscript()}Ê∞ßÂåñ${nonMetalName}`;
                }
            }
            
            // ÁõêÔºàÈáëÂ±û + ÈÖ∏Ê†πÔºâ
            if (elementEntries.length === 2) {
                const metal = elementEntries.find(([e, _]) => ['Na', 'K', 'Ca', 'Mg', 'Ag', 'Zn', 'Ba', 'Cu', 'Hg', 'Al', 'Fe', 'Mn', 'Au', 'Pt'].includes(e));
                const acidRoot = elementEntries.find(([e, _]) => ['OH', 'NO3', 'SO4', 'CO3', 'Cl'].includes(e));
                
                if (metal && acidRoot) {
                    const metalName = elementsData[metal[0]].name;
                    const metalCount = elements[metal[0]];
                    const rootName = elementsData[acidRoot[0]].name;
                    const rootCount = elements[acidRoot[0]];
                    
                    if (acidRoot[0] === 'Cl') {
                        return `Ê∞ØÂåñ${metalName}${metalCount > 1 ? metalCount.toSubscript() : ''}`;
                    }
                    
                    let result = `${rootName.replace('Ê†π', '')}${metalName}`;
                    if (metalCount > 1) result += metalCount.toSubscript();
                    if (rootCount > 1) result += rootCount.toSubscript();
                    return result;
                }
            }
            
            // ÈªòËÆ§ÔºöÊåâÂÖÉÁ¥†È°∫Â∫èÂëΩÂêç
            const sortedElements = elementEntries.sort(([elem1, count1], [elem2, count2]) => {
                const data1 = elementsData[elem1];
                const data2 = elementsData[elem2];
                
                const metals = ['Na', 'K', 'Ca', 'Mg', 'Ag', 'Zn', 'Ba', 'Cu', 'Hg', 'Al', 'Fe', 'Mn', 'Au', 'Pt'];
                const isMetal1 = metals.includes(elem1);
                const isMetal2 = metals.includes(elem2);
                if (isMetal1 && !isMetal2) return -1;
                if (!isMetal1 && isMetal2) return 1;
                
                if (data1.electronegativity !== data2.electronegativity) {
                    return data1.electronegativity - data2.electronegativity;
                }
                
                return elem1.localeCompare(elem2);
            });
            
            const names = sortedElements.map(([e, c]) => {
                const name = elementsData[e].name;
                return c > 1 ? c.toSubscript() + name : name;
            });
            
            return names.join('') + 'ÂåñÂêàÁâ©';
        }

        // ÁîüÊàêÂª∫ËÆÆ
        function generateSuggestions(elements) {
            const suggestions = [];
            const elementKeys = Object.keys(elements);
            
            if (elementKeys.includes('H') && elementKeys.includes('O')) {
                suggestions.push({
                    formula: 'H‚ÇÇO',
                    name: 'Ê∞¥',
                    reason: 'Ê∞¢Ê∞ßÂÖÉÁ¥†ÁªÑÂêà'
                });
            }
            
            if (elementKeys.includes('N') && elementKeys.includes('H')) {
                suggestions.push({
                    formula: 'NH‚ÇÉ',
                    name: 'Ê∞®',
                    reason: 'Ê∞ÆÊ∞¢ÂÖÉÁ¥†ÁªÑÂêà'
                });
            }
            
            if (elementKeys.includes('C') && elementKeys.includes('O')) {
                suggestions.push({
                    formula: 'CO‚ÇÇ',
                    name: '‰∫åÊ∞ßÂåñÁ¢≥',
                    reason: 'Á¢≥Ê∞ßÂÖÉÁ¥†ÁªÑÂêà'
                });
            }
            
            if (elementKeys.includes('Na') && elementKeys.includes('Cl')) {
                suggestions.push({
                    formula: 'NaCl',
                    name: 'Ê∞ØÂåñÈí†',
                    reason: 'Èí†Ê∞ØÂÖÉÁ¥†ÁªÑÂêà'
                });
            }
            
            if (elementKeys.includes('NH4') && elementKeys.includes('Cl')) {
                suggestions.push({
                    formula: 'NH‚ÇÑCl',
                    name: 'Ê∞ØÂåñÈìµ',
                    reason: 'ÈìµÊ†πÊ∞ØÂÖÉÁ¥†ÁªÑÂêà'
                });
            }
            
            if (elementKeys.includes('NH4') && elementKeys.includes('NO3')) {
                suggestions.push({
                    formula: 'NH‚ÇÑNO‚ÇÉ',
                    name: 'Á°ùÈÖ∏Èìµ',
                    reason: 'ÈìµÊ†πÁ°ùÈÖ∏Ê†πÁªÑÂêà'
                });
            }
            
            if (elementKeys.includes('NH4') && elementKeys.includes('SO4')) {
                suggestions.push({
                    formula: '(NH‚ÇÑ)‚ÇÇSO‚ÇÑ',
                    name: 'Á°´ÈÖ∏Èìµ',
                    reason: 'ÈìµÊ†πÁ°´ÈÖ∏Ê†πÁªÑÂêà'
                });
            }
            
            return suggestions.slice(0, 3);
        }

        // ÊòæÁ§∫ÁªìÊûú
        function showResult(success, message, details = {}) {
            const resultSection = document.getElementById('resultSection');
            const resultTitle = document.getElementById('resultTitle');
            const resultContent = document.getElementById('resultContent');
            
            resultSection.style.display = 'block';
            resultSection.className = success ? 'result-section' : 'result-section error';
            
            resultTitle.className = success ? 'result-title result-success' : 'result-title result-error';
            resultTitle.innerHTML = success ? '‚úÖ Ê£ÄÈ™åÊàêÂäü' : '‚ùå Ê£ÄÈ™åÂ§±Ë¥•';
            
            let content = `<p>${message}</p>`;
            
            if (success && details) {
                if (details.formula) {
                    content += `<div class="formula-display">${details.formula}</div>`;
                }
                if (details.name) {
                    content += `<p><strong>ÂåñÂêàÁâ©ÂêçÁß∞Ôºö</strong>${details.name}</p>`;
                }
                if (details.valences) {
                    content += '<p><strong>ÂåñÂêà‰ª∑Ôºö</strong></p><div class="valence-list">';
                    Object.entries(details.valences).forEach(([element, valence]) => {
                        content += `<span class="valence-item">${element}: ${valence > 0 ? '+' : ''}${valence}</span>`;
                    });
                    content += '</div>';
                    
                    const balance = calculateValenceBalance(details.elements || {}, details.valences);
                    content += `<p><strong>ÂåñÂêà‰ª∑È™åËØÅÔºö</strong> ${balance === 0 ? '‚úì ÂåñÂêà‰ª∑Âπ≥Ë°°' : '‚úó ÂåñÂêà‰ª∑‰∏çÂπ≥Ë°°'}</p>`;
                }
            } else if (details.suggestions) {
                content += '<div class="suggestions">';
                content += '<div class="suggestions-title">Êé®ËçêÂåñÂêàÁâ©Ôºö</div>';
                details.suggestions.forEach(suggestion => {
                    content += `<div class="suggestion-item">
                        <strong>${suggestion.formula}</strong> - ${suggestion.name} (${suggestion.reason})
                    </div>`;
                });
                content += '</div>';
            }
            
            resultContent.innerHTML = content;
        }

        // ÂàùÂßãÂåñ
        init();
        
        // Âä†ËΩΩÂπ∂Â∫îÁî®Ê∑±Ëâ≤Ê®°ÂºèËÆæÁΩÆ
        document.addEventListener('DOMContentLoaded', function() {
            const SETTINGS_KEY = 'chemistry_settings';
            const savedSettings = localStorage.getItem(SETTINGS_KEY);
            
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                if (settings.darkMode) {
                    document.body.style.background = '#1a1a2a';
                }
            }
        });
    </script>
</body>
</html>